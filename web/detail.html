<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css"> 
    <link rel="stylesheet" href="{{ url_for('static',filename='css/ui.jqgrid-bootstrap.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static',filename='css/visual.css') }}" />

    <script>window.$ = window.jQuery = require('jquery');</script>
    <script src="//code.jquery.com/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="{{ url_for('static',filename='app/js/i18n/grid.locale-en.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static',filename='app/js/jquery.jqGrid.min.js') }}"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script>
		$.jgrid.defaults.width = 1180;
		$.jgrid.defaults.responsive = true;
		$.jgrid.defaults.styleUI = 'Bootstrap';
    </script>
</head>

<body>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <table style="width: 100%; height: 100%; margin-top: 30px">
        <tr>
            <td rowspan="2" style="width: 30%; height: 50%; padding-top: 20px; padding-left: 20px">Bar Chart</td>
            <td style="height: 20%; padding-top: 20px">Portion of topic</td>
        </tr>
        <tr>
            <td rowspan="2" style="height: 60%; padding-top: 20px; padding-right: 20px">
                <div id='layout-table'>
                    <table id="jqGrid"></table>
                    <div id="jqGridPager"></div>
                </div>
            </td>
        </tr>
        <tr>
            <td rowspan="2" style="width: 30%; height: 50%; padding-top: 20px; padding-left: 20px">entities</td>
        </tr>
        <tr>
            <td style="height: 20%; padding-top: 20px; padding-right: 20px">
                <div id='entities_render'></div>
            </td>
        </tr>
    </table>
</body>
<script type="text/javascript">
    var bar_json = {{ bar_json | tojson }};
    var document_table_json = {{ document_table_json | tojson }};

    function get_entities(dataidx) {
        $.ajax({
            url: '/entities',
            type: 'POST',
            data: { idx: dataidx, data: JSON.stringify(document_table_json) },
            success: function(res) {
                $('#entities_render').html(JSON.parse(res).dochtml)
            },
            error: function(error){ 
                console.log(error); 
            }
        })
    }

    $(document).ready(function() {
        tableData = document_table_json.rows
        initializeTable(tableData)
    })

    function initializeTable(data) {
        var columns = ['document', 'topic_lda', 'topic_km', 'topic_dec'];
        var columnLabels = ['Document', 'Topic(lda)', 'Topic(KM)', 'Topic(DEC)'];
        var colw = [70, 10, 10, 10]
        var colModel = [];

        for (i = 0; i < columns.length; i++) {
            colModel.push({
                label: columnLabels[i],
                name: columns[i],
                width: colw[i]
            });
        }

        $("#jqGrid").jqGrid({
            data: data,
            datatype: "local",
            colModel: colModel,
            viewrecords: true,
            width: 1170,
            height: 570,
            rowNum: 15,
            autowidth: true,
            shrinktofit: true,
            pager: "#jqGridPager",
            onSelectRow: function(rowidx) {    
                pgidx = $(".ui-pg-input").val()
                dataidx = $("#jqGrid").getGridParam("reccount") * (pgidx-1) + (rowidx * 1) - 1

                get_entities(dataidx)
            }
        });
        $('#jqGrid').jqGrid('navGrid', "#jqGridPager", {
            search: false,
            add: false,
            edit: false,
            del: false,
            view: true,
            refresh: true
        },
            {}, // edit options
            {}, // add options
            {}, // delete options
            {} // search options - define multiple search
        );
    }
</script>
</html>